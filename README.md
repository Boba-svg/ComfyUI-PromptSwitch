# ComfyUI-PromptSwitch

プロンプトの切り替えや管理を効率化するためのカスタムノードです。

---

Git Hubで公開された「PromptSwitch」について、これまでの修正と統合された内容に基づき、主な機能を説明します。このノードは、**プロンプトの管理とノード操作の効率化**に特化しています。

***

## ⚙️ PromptSwitch の主な機能

このカスタムノードの核となる機能は、プロンプトの各行を独立して有効/無効化（コメントアウト）し、さらに柔軟な操作とショートカットを提供することです。

### 1. インタラクティブなプロンプト管理

ノードの表示モード（非編集モード）において、プロンプトの各行がチェックリストのように表示され、以下の操作が可能です。

* **行のON/OFF切り替え（活性化/コメントアウト）** 🟢/⚫
    * ノード内のテキスト行をクリックすることで、その行のプロンプトを即座に有効化（ON）または無効化（OFF/コメントアウト）できます。
* **空行に区切り線（Separator Line）を描画** ✅
    * プロンプトのブロック分けに利用される空行に対して、視認性を高めるための**細い横線**が描画されます。（オリジナルの課題修正）
* **プロンプトウェイトの視覚的な調整**
    * 各行の右側に表示される **`[+]` / `[-]` ボタン**をクリックすることで、その行のプロンプトウェイトを**`CONFIG.WEIGHT_STEP` (デフォルト 0.10)** 単位で増減できます。
    * ウェイトが **1.00 以外**の場合、その値がボタンの隣に表示されます。
* **表示の最適化と視覚的な改善**
    * **テキストの自動省略**：行の文字数が多すぎる場合、ノードの見た目が崩れないように自動的に省略表示されます。
    * **コメントの調整**：コメントアウトされた行（`#` または `//` で始まる行）について、以下の視覚的な調整が可能です。
        * **コメント記号 `//` を非表示**にできます (`CONFIG`で設定)。
        * コメントの**文字色やフォントサイズ**をカスタマイズしました。特に日本語コメントで発生していた行の崩れに対応しています。

### 2. ノードのモード切り替え

* **編集モード（Edit Mode）** 📝
    * **`F2` キー** または **`E` キー**、または **ノード本体の左枠・下枠・右枠をダブルクリック**することで、通常のテキスト入力ウィジェットを表示/非表示に切り替えることができます。

* **コンパクトモード（Visible/Invisible）**
    * **`V` キー**を押すことで、選択中のノードの表示モードを切り替えます。
        * **通常モード（展開）**: 全ての行（有効/無効、空行）が表示され、ノードがコンテンツに合わせてリサイズされます。
        * **コンパクトモード（最小化）**: バージョン情報、空行、完全にコメントアウトされた無効な行を非表示にし、ノードの高さを最小限に抑えます。

***

## 🚀 効率化のためのショートカット機能

作業のスピードアップを目的とした、強力なキーボードショートカットを提供します。

| ショートカット | 機能 | 説明 |
| :--- | :--- | :--- |
| **A** | **All Prompts Toggle** | 選択中のPromptSwitchノードの**全てのプロンプト行**を、一括でON/OFF切り替えます（トグル動作）。 |
| **Shift + A** | **全ノード全無効化** 💥 | **キャンバス上の全てのPromptSwitchノード**のプロンプトを、一括で**強制的に無効化（コメントアウト）**します。|
| **R** | **Reset Weights** | 選択中のノード内の**全てのプロンプトのウェイト**を、一括で **`1.0`** にリセット（括弧を削除）します。(`CONFIG`で有効/無効を制御)|
| **Shift + V** | **全ノード Visible/Invisible** | **キャンバス上の全てのPromptSwitchノード**の表示モードを、一括で**トグル**切り替えします（コンパクト ⇔ 通常）。 |
| **F1** | **Help** | このノードの主要なショートカット一覧を表示します。|

***

## 🔧 設定変数によるカスタマイズ

`web/index.js` の `CONFIG` オブジェクト内の変数を `true` / `false` などで設定することで、ノードの振る舞いを細かく調整できます。

| 変数名 | デフォルト値 | 説明 |
| :--- | :--- | :--- |
| `ENABLE_SHIFT_A_CONFIRMATION` | `false` | **Shift+A**実行前に全ノード無効化の**確認ダイアログ**を表示するかどうかを制御します。`false`で即時実行。 |
| `ENABLE_R_KEY_RESET` | `true` | **Rキー**による**ウェイトリセット機能**の有効/無効を切り替えます。 |
| `ENABLE_DBLCLICK_TOGGLE` | `true` | **ダブルクリック**による**編集モード切替**の有効/無効を切り替えます。 |
| `HIDE_COMMENT_SLASH` | `true` | コメント行の先頭にある **`//` を非表示**にするかどうかを制御します。|
| `COMMENT_COLOR` | `'#777777'` | コメントアウトされた行のテキスト色を指定します。|
| `COMMENT_FONT_SIZE` | `10` | コメントアウトされた行のフォントサイズをピクセル単位で指定します。日本語の行崩れ対策。|
| `WEIGHT_STEP` | `0.10` | ウェイト増減ボタン (`[+]`/`[-]`) で増減する単位量を設定します。|

---

## 🛠️ インストール

現在、**ComfyUI Managerへの登録準備中**です。それまでは、以下のGitコマンドを使った手動インストールをお願いします。

### 手動インストール手順 (Git Clone)

1.  ComfyUIがインストールされているフォルダ内の **`custom_nodes` フォルダ**へ移動します。

    ```bash
    cd /path/to/ComfyUI/custom_nodes
    ```

2.  以下のコマンドでリポジトリをクローン（ダウンロード）します。

    ```bash
    git clone [https://github.com/Boba-svg/ComfyUI-PromptSwitch](https://github.com/Boba-svg/ComfyUI-PromptSwitch)
    ```

3.  ComfyUIを再起動します。

---

## 💡 使用方法

1.  ノード検索メニュー（右クリックまたは`Ctrl + Space`）から、**ユーティリティ（utils）**カテゴリなどからノードを呼び出します。
2.  ノードをにフォーカスを合わせて**`F1`キー**を押すと、ノードの詳細なヘルプが表示されます。

---
## 💡 更新内容
1. 25/10/16 公開
---
## 💡 更新予定
1. ノード表示の最適化: 通常モードにおいて、最上行と最下行の不必要なライン表示を抑制し、視覚的なノイズを軽減します。

---

## 🌟 クレジット (Credit) / 謝辞 (Acknowledgement)

このカスタムノード（ComfyUI-PromptSwitch）は、**kambara**氏によって開発された素晴らしいプロジェクト [`ComfyUI-PromptPalette`](https://github.com/kambara/ComfyUI-PromptPalette) をフォークし、大幅に改変したものです。

オリジナルの作者とプロジェクトに深く感謝いたします。

---

## 📝 ライセンス

このプロジェクトは、オリジナルと同じく **MITライセンス**の下で公開されています。

詳細はリポジトリ内の [`LICENSE`ファイル](https://github.com/Boba-svg/ComfyUI-PromptSwitch/blob/main/LICENSE) をご確認ください。
