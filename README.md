# ComfyUI-PromptSwitch ✨プロンプト作業を劇的に高速化！✨

**プロンプトのON/OFF切り替えやウェイト調整**を、まるでチェックリストのように直感的に行えるカスタムノードです。

---

🎉 Git Hubで公開された「PromptSwitch」へようこそ！

これは、**Prompt Palette の優れたアイデア**をベースに、**プロンプト管理とノード操作の快適さ**を追求して大幅に改善したバージョンです。

このノードには、以下のマークを使用し、機能の起源を区別しています。

* **⚡️ \[Original]**: Prompt Paletteから受け継いだ、核となる基本的な機能
* **🆕 \[Switch]**: PromptSwitchで独自に追加・改善された機能

***

## 🚀 PromptSwitch の主な機能

このカスタムノードのすごいところは、プロンプトの各行を独立して操作できる点、そして細かいカスタマイズができる点にあります。

### 機能説明と操作イメージ 🎮

PromptSwitchの主要機能、特にコメントの見やすさ改善やウェイト調整、そしてPrompt Paletteから引き継いだ「EDITモードでの機能維持」を一枚で解説しています。

![機能説明](images/setsumei.png)

### 1. 超直感的！インタラクティブなプロンプト管理

ノードが非編集モードのとき、プロンプトの各行が「チェックリスト」のように表示されます。

* **⚡️ \[Original] 行のON/OFF切り替え（活性化/コメントアウト）** 🟢/⚫
    * ノード内のテキスト行を**クリック**するだけで、そのプロンプトを瞬時に有効化/無効化できます。試行錯誤が超スムーズに！
* **⚡️ \[Original] プロンプトウェイトの微調整が簡単！** ⚖️
    * 各行の右にある **`[+]` / `[-]` ボタン**をクリックするだけで、ウェイトを **`CONFIG.WEIGHT_STEP` (デフォルト 0.10)** 単位でサクサク増減できます。ウェイト値はボタンの隣に表示されます。
* **⚡️ \[Original] 編集モード（Edit Mode）でも機能が有効** ✏️
    * **編集モードのまま**、通常のプロンプト入力ノードとして機能し続けます。編集と実行をシームレスに行き来できます。
* **🆕 \[Switch] 空行に区切り線（Separator Line）を描画** ✅
    * プロンプトブロックの視認性を高めるため、**空行**に対して細い横線が自動で描画されます。（オリジナルのちょっとした不満点を解消！）
* **🆕 \[Switch] 表示がとにかく見やすい！視覚的な大改善** 👀
    * **テキストの自動省略**：行の文字数が多すぎる場合、ノードの見た目が崩れないように自動的に省略表示されます。
    * **コメントの見やすさ調整**：コメントアウトされた行（`#` や `//` で始まる行）について、以下の視覚的な調整が可能です。
        * **コメント記号 `//` は非表示になります**。
        * コメントの色や**フォントサイズを最適化**し、メインのプロンプトがより際立つように調整されています。

### 2. ノードのモード切り替え

* **✏️ 編集モード（Edit Mode）**
    * **`F2`** または **`E` キー**、または **ノード本体の左・下・右枠をダブルクリック**で、通常のテキスト入力エリアを表示/非表示に切り替えられます。
* **🆕 \[Switch] ミニマムモード（Visible/Invisible）**
    * **`V` キー**で、選択中のノードの表示を切り替え！
        * **通常モード（展開）**: 全ての行を表示し、プロンプト編集に集中できます。
        * **コンパクトモード（最小化）**: バージョン情報や無効な行を非表示にして、ノードの高さを最小限に抑えます。キャンバスを広く使いたい時に便利！

***

## 🚀 爆速作業のためのショートカット機能 💨

作業のスピードアップを目的とした、強力なキーボードショートカットを提供します。（**注: これらは全てPromptSwitchで独自に追加・強化された機能です！**）

| ショートカット | 機能 | 説明 |
| :--- | :--- | :--- |
| **A** | **まとめてON/OFF** | 選択中のノードの**全てのプロンプト行**を一括でON/OFF切り替え（トグル）！ |
| **Shift + A** | **全ノード強制無効化** 🚨 | **キャンバス上の全てのPromptSwitchノード**のプロンプトを、一括で**強制的にコメントアウト**します。万が一の時に安心！|
| **R** | **ウェイト一発リセット** | 選択中のノード内の**全てのウェイト**を、一括で **`1.0`** にリセット（括弧を削除）します。|
| **Shift + V** | **全ノード表示モード一括変更** | **キャンバス上の全PromptSwitchノード**の表示を、一括で**コンパクト ⇔ 通常**に切り替え！ |
| **F1** | **ヘルプを表示** | このノードの主要なショートカット一覧をすぐに確認できます。|

***

## ⚡️ \[Original] プロンプト管理をテキストエディターで出来る事による強力な応用性

Prompt Paletteのテキストエディター機能は、プロンプト編集に強力な応用性をもたらします。その一部をご紹介します。

### 1. 他の方の作ったプロンプトの導入のしやすさ

プロンプトをコピー後、別途エディターで「カンマ」を「カンマ＋改行文字」に置換して本ノードに貼り付けると、**即座にすべての要素がリスト化**されます。

### 2. プロンプト紹介サイト＋チャットAIを活用する活用法

プロンプト紹介サイトやチャットAIを活用することで、労せずに強力なプロンプトリストを入手し、再検索の手間を省くことができます。

1.  チャットAIの入力画面にまず、以下の指示文を打ちます。（エンターはまだ押さないで）
    ```
    こちらの中のプロンプトとそれに対するコメントを「プロンプト // コメント」という形で抽出してほしい。カテゴリが変わったら空白行を入れて、一回のコピーボタンですむようにまとめて。
    ```
2.  そしてプロンプト紹介サイトの内容を `Ctrl + A` → `Ctrl + C` でコピーし、上記の入力のあとに貼り付けをしてエンター。
3.  チャットAIは「プロンプト // コメント」の形でそのページのプロンプトをリスト化し、コピーボタンまで用意してくれるでしょう。
4.  それをPromptSwitchに貼り付ければ、**即強力なプロンプトリストを入手**でき、忘れるたびにプロンプト紹介サイトを検索する手間から逃れることができます。

***

## 🔧 カスタマイズ大歓迎！設定変数リスト

`web/index.js` の `CONFIG` オブジェクトを直接編集することで、ノードの細かい振る舞いを調整できます。

| 変数名 | デフォルト値 | 説明 |
| :--- | :--- | :--- |
| `ENABLE_SHIFT_A_CONFIRMATION` | `false` | **Shift+A**実行前に全ノード無効化の**確認ダイアログ**を表示するかどうか。`false`で即時実行。 |
| `ENABLE_R_KEY_RESET` | `true` | **Rキー**による**ウェイトリセット機能**の有効/無効を切り替えます。 |
| `ENABLE_DBLCLICK_TOGGLE` | `true` | **ダブルクリック**による**編集モード切替**の有効/無効を切り替えます。 |
| `COMMENT_COLOR` | `'#777777'` | コメントアウトされた行のテキスト色を指定します。|
| `COMMENT_FONT_SIZE` | `10` | コメントアウトされた行のフォントサイズをピクセル単位で指定。日本語対応済み！|
| `WEIGHT_STEP` | `0.10` | ウェイト増減ボタン (`[+]`/`[-]`) で増減する単位量を設定します。|

---

## 🛠️ インストール方法

現在、**ComfyUI Managerへの登録準備中**です！それまでは、以下のGitコマンドを使った手動インストールをお願いします🙇‍♂️。

### 手動インストール手順 (Git Clone)

1.  ComfyUIがインストールされているフォルダ内の **`custom_nodes` フォルダ**へ移動します。

    ```bash
    cd /path/to/ComfyUI/custom_nodes
    ```

2.  以下のコマンドでリポジトリをクローン（ダウンロード）します。

    ```bash
    git clone https://github.com/Boba-svg/ComfyUI-PromptSwitch
    ```

3.  ComfyUIを再起動すれば完了です！

---

## 💡 使用方法

1.  ノード検索メニュー（右クリックまたは`Ctrl + Space`）から、**ユーティリティ（utils）**カテゴリなどからノードを呼び出します。
2.  ノードにフォーカスを合わせて**`F1`キー**を押すと、ノードの詳細なヘルプが表示されます。

---
## 💡 アップデート履歴
1. 25/10/16 公開
---
## 💡 次の更新予定
1. ノード表示の最適化: 通常モードにおいて、最上行と最下行の不必要なライン表示を抑制し、視覚的なノイズを軽減します。

---

## 🌟 クレジット (Credit) / 感謝！ 🙏

このカスタムノード（ComfyUI-PromptSwitch）は、**kambara**氏によって開発された優れたプロジェクト [`ComfyUI-PromptPalette`]([https://github.com/kambara/ComfyUI-PromptPalette](https://github.com/kambara/ComfyUI-PromptPalette)) のアイデアをフォークし、大幅に機能拡張したものです。

オリジナルの作者とプロジェクトに心から感謝いたします。

---

## 📝 ライセンス

このプロジェクトは、オリジナルと同じく **MITライセンス**の下で公開されています。

詳細はリポジトリ内の [`LICENSE`ファイル]([https://github.com/Boba-svg/ComfyUI-PromptSwitch/blob/main/LICENSE](https://github.com/Boba-svg/ComfyUI-PromptSwitch/blob/main/LICENSE)) をご確認ください。
